<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>2026æŒªå¨å†°å³¶ä¹‹æ—…</title>
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="2026æŒªå¨å†°å³¶ä¹‹æ—…">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#F0F4F8">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="https://img.icons8.com/color/180/snowflake.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
<div id="fixed-bg"></div>

<div id="app">
  <div class="pull-indicator" :style="{ height: pullDistance + 'px' }">
    <div v-if="pullDistance > 20" class="pull-pill">{{ refreshText }}</div>
  </div>

  <div id="app-shell" :style="{ transform: `translateY(${pullDistance}px)`, transition: pullDistance>0 ? 'none' : 'transform 180ms ease' }">
  <div class="px-6 pb-4 swipe-protected relative z-20 bg-white/70 backdrop-blur-xl border-b border-white/50"
       style="padding-top: max(20px, env(safe-area-inset-top) + 12px);">
    <div class="flex justify-between items-center">
      <h1 class="text-xl font-black tracking-tight text-[#4A5E70]">2026 æŒªå¨å†°å³¶ä¹‹æ—…</h1>
      <div class="text-right">
        <button v-if="isSyncing" class="bg-[#99A799] text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 mb-1 ml-auto animate-pulse">
           <span class="w-1.5 h-1.5 bg-white rounded-full animate-ping"></span> Syncing
        </button>
        <button v-else-if="syncQueue.length > 0" @click="confirmClearSync" class="bg-[#DBCFB0] text-[#5A4E3A] px-3 py-1 rounded-full text-xs font-bold animate-pulse flex items-center gap-1 mb-1 ml-auto">
          å¾…ä¸Šå‚³ ({{ syncQueue.length }})
        </button>
        <div class="text-lg font-black text-[#55697B] leading-none tracking-wide font-mono mt-1">{{ todayDate }}</div>
        <div class="text-[10px] text-[#8DA3B5] font-bold opacity-100 mt-1 uppercase tracking-[0.2em]">{{ todayWeekday }}</div>
      </div>
    </div>
    <div class="flex justify-between items-center mt-4">
      <div class="glass-input px-3 py-1.5 rounded-full text-[10px] font-bold text-[#8DA3B5] tracking-wide">AUG 30 - SEP 26</div>
      <div class="flex gap-2">
        <span v-if="!isOnline" class="bg-slate-400 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1">é›¢ç·š</span>
        <span v-if="tripStatus" class="bg-[#2F86B8] text-white px-4 py-1 rounded-full text-xs font-bold tracking-wide shadow-sm">{{ tripStatus }}</span>
      </div>
    </div>
  </div>

  <div class="flex tab-bar z-10 text-sm font-bold swipe-protected flex-shrink-0">
    <button @click="tab='itinerary'" :class="['flex-1 p-4 tab-btn', tab==='itinerary'?'tab-active':'']">è¡Œç¨‹</button>
    <button @click="tab='expense'" :class="['flex-1 p-4 tab-btn', tab==='expense'?'tab-active':'']">è¨˜å¸³</button>
    <button @click="changeTabToAnalysis" :class="['flex-1 p-4 tab-btn', tab==='analysis'?'tab-active':'']">åˆ†æ</button>
  </div>

  <div class="scrollable-content p-4" ref="scrollContainer">
    <Transition name="fade" mode="out-in">
      
      <div v-if="tab==='itinerary'" key="itinerary">
        <div ref="dateContainer" class="overflow-x-auto whitespace-nowrap pb-4 px-1 scrollbar-hide scroll-smooth swipe-protected">
          <button v-for="d in tripDates" :key="d.date" :id="'date-btn-' + d.date" @click="selectDate(d.date)"
                  :class="[
                    'px-4 py-2.5 rounded-2xl text-xs mr-2 border transition-all duration-300 font-bold shadow-sm',
                    selDate===d.date ? 'bg-[#2F86B8] text-white border-[#2F86B8] scale-105'
                                     : 'glass-input text-[#8DA3B5] border-transparent hover:bg-white'
                  ]">
            {{ d.short }}
          </button>
        </div>

        <div v-if="isLoading && itinerary.length===0" class="space-y-4">
          <div v-for="i in 3" :key="i" class="glass-card h-24 skeleton"></div>
        </div>

        <div v-else>
          <div class="text-center mb-6">
            <div class="inline-block glass-input px-6 py-2 rounded-full text-sm font-bold text-[#6B7C8E] shadow-sm">
              {{ getDayInfo(selDate) }}
            </div>
          </div>

          <div v-for="evt in getEvents(selDate)" :key="evt.row"
               :class="['glass-card flex mb-4 items-stretch relative group pl-0', getCategoryBorderClass(evt.category), isItemPending(evt.row) ? 'pending-sync' : '']">
            
            <div class="w-16 flex flex-col justify-center items-center p-2 border-r border-slate-100 flex-shrink-0">
              <div class="font-black text-sm text-[#55697B]">{{ evt.startTime }}</div>
              <div v-if="evt.endTime" class="text-[10px] text-[#94A3B8] mt-1 font-medium">{{ evt.endTime }}</div>
              <div class="mt-2 text-[10px] font-bold px-1.5 py-0.5 rounded text-[#8DA3B5] bg-[#F0F4F8] border border-[#E2E8F0] tracking-wider">
                {{ evt.category }}
              </div>
            </div>

            <div class="flex-1 p-4 relative min-w-0">
              <div class="flex justify-between items-start">
                <span v-if="!evt.link" class="font-bold text-base text-[#4A5E70] leading-tight truncate pr-2">
                  {{ evt.title }}
                </span>
                <a v-else :href="evt.link" target="_blank" class="title-link text-base leading-tight truncate pr-2 swipe-protected">
                  {{ evt.title }}
                </a>
              </div>

              <div class="text-xs mt-2 text-[#8DA3B5] flex items-start gap-2" v-if="evt.location">
                <span class="flex-1 pt-1 opacity-80 break-words">ğŸ“ {{ evt.location }}</span>
                <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(evt.location)" target="_blank" class="map-btn swipe-protected">åœ°åœ–</a>
              </div>

              <div v-if="evt.imgUrl" class="mt-2">
                  <img :src="evt.imgUrl" class="itinerary-img" loading="lazy" @click.stop="viewImage(evt.imgUrl)">
              </div>

              <div class="text-sm mt-3 text-[#6B7C8E] whitespace-pre-wrap opacity-90 allow-select break-anywhere note-content"
                @click.stop v-if="evt.note" v-html="formatNote(evt.note)"></div>

              <div class="mt-3 flex gap-2 justify-end swipe-protected">
                <button @click.stop="openEditItin(evt)" class="text-[10px] text-[#2F86B8] bg-[#EBF1F5] border border-[#CBD5E1] px-3 py-1 rounded-lg font-bold flex-shrink-0">ç·¨è¼¯</button>
                <button @click.stop="deleteItin(evt)" class="text-[10px] text-[#D4A5A5] bg-[#FCEEEE] border border-[#F5E6E6] px-3 py-1 rounded-lg font-bold flex-shrink-0">åˆªé™¤</button>
              </div>
            </div>
          </div>

          <button @click="openAddItin"
        class="w-full py-4 mt-4 border-2 border-dashed border-[#B0C4DE] text-[#8DA3B5] bg-white/50 rounded-2xl font-bold hover:bg-[#F0F4F8] transition swipe-protected shadow-sm"> + æ–°å¢è¡Œç¨‹</button>
          <div class="h-10"></div>
        </div>
      </div>

      <div v-else-if="tab==='expense'" key="expense">
        <div class="glass-card p-6 space-y-5 shadow-lg swipe-protected border-l-[6px] border-[#9DB6CC]">
          <h3 class="font-bold text-[#55697B] text-lg flex items-center gap-2">æ–°å¢æ¶ˆè²»</h3>
          <div class="flex gap-3">
            <select v-model="newExp.payer" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>æ³¥æ˜¯èª°</option><option>å®¶é½Š</option><option>äº­ç©</option><option>åª½åª½</option><option>ç¿ŠèŒ¹</option></select>
            <select v-model="newExp.location" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>åœ¨å“ªæ¶ˆè²»</option><option>å°ç£</option><option>æœæ‹œ</option><option>æŒªå¨</option><option>å†°å³¶</option><option>è‹±åœ‹</option></select>
          </div>
          <div class="flex gap-3">
            <select v-model="newExp.item" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>æ¶ˆè²»é …ç›®</option><option>æ—©é¤</option><option>åˆé¤</option><option>æ™šé¤</option><option>é›¶é£Ÿ</option><option>ä½å®¿</option><option>äº¤é€šï¼ˆæ©Ÿç¥¨ï¼‰</option><option>äº¤é€šï¼ˆç§Ÿè»Šï¼‰</option><option>äº¤é€šï¼ˆåœè»Šè²»ï¼‰</option><option>äº¤é€šï¼ˆæ²¹éŒ¢ï¼‰</option><option>ç´€å¿µå“</option><option>é–€ç¥¨</option><option>å…¶ä»–</option></select>
            <select v-model="newExp.payment" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>ä»˜æ¬¾æ–¹å¼</option><option>ç¾é‡‘</option><option>ä¿¡ç”¨å¡-åœ‹æ³°</option><option>ä¿¡ç”¨å¡-æ°¸è±</option><option>ä¿¡ç”¨å¡-å…ƒå¤§</option></select>
          </div>
          <div class="flex gap-3">
            <select v-model="newExp.currency" class="w-1/3 glass-input p-3 rounded-xl text-sm font-bold bg-[#E2E8F0] text-slate-600"><option>NTD</option><option>NOK</option><option>ISK</option><option>EUR</option><option>GBP</option><option>AED</option></select>
            <input type="number" v-model="newExp.amount" placeholder="é‡‘é¡" class="w-2/3 glass-input p-3 rounded-xl outline-none text-xl font-mono font-bold text-slate-700">
          </div>
          <div class="text-xs text-right text-slate-400 font-mono font-bold" v-if="newExp.amount && newExp.currency !== 'NTD'">â‰ˆ {{ formatNumber(Math.round(newExp.amount * rates[newExp.currency])) }} NTD</div>
          <input v-model="newExp.note" placeholder="å‚™è¨» (é¸å¡«)" class="w-full glass-input p-3 rounded-xl text-sm outline-none">
          <div class="bg-slate-50/50 p-4 rounded-xl border border-slate-100">
            <div class="flex justify-between items-center mb-3">
              <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">åˆ†æ”¤çµ¦</span>
              <button @click="toggleSelectAll" class="text-[10px] text-[#2F86B8] font-bold bg-white px-2 py-1 rounded shadow-sm">å…¨é¸</button>
            </div>
            <div class="flex gap-2 flex-wrap">
              <label v-for="m in members" :key="m" class="flex flex-1 justify-center items-center space-x-2 border px-4 py-3 rounded-xl cursor-pointer transition-all duration-200" :class="newExp.involved.includes(m)?'bg-white border-[#2F86B8] text-[#55697B] shadow-sm':'bg-transparent border-slate-200 text-slate-400'"><input type="checkbox" :value="m" v-model="newExp.involved" class="hidden"><span class="text-sm font-bold">{{m}}</span></label>
            </div>
          </div>
          <button @click="submitExp" class="w-full btn-glacier py-4 rounded-xl font-bold text-lg tracking-wide">ç¢ºèªè¨˜å¸³</button>
        </div>
      </div>

      <div v-else-if="tab==='analysis'" key="analysis">
        <div class="flex justify-end mb-3 swipe-protected">
          <button @click="openRateModal" class="text-xs text-slate-500 bg-white/50 border border-white px-4 py-2 rounded-full flex items-center shadow-sm backdrop-blur-sm font-bold">åŒ¯ç‡è¨­å®š</button>
        </div>

        <div class="bg-gradient-to-br from-[#2F86B8] to-[#2F86B8] text-white rounded-3xl p-6 shadow-xl mb-6 relative overflow-hidden ring-1 ring-white/20">
          <div class="border-b border-white/10 pb-3 mb-3 flex justify-between items-center relative z-10">
            <div class="text-xs font-medium opacity-80 tracking-widest uppercase">å®¶é½Š+äº­ç© é ç®—</div>
            <div class="font-bold text-lg font-mono tracking-wider opacity-90">500,000</div>
          </div>
          <div class="flex justify-between items-end relative z-10">
            <div>
              <div class="text-4xl font-black tracking-tighter drop-shadow-sm">{{ formatNumber(Math.round(500000 - publicSpent)) }}</div>
              <div class="text-xs font-bold opacity-70 mt-1">å‰©é¤˜ç¶“è²» (NTD)</div>
            </div>
            <div class="text-right">
              <div class="text-lg font-bold">{{ formatNumber(Math.round(publicSpent)) }}</div>
              <div class="text-xs opacity-70 font-medium">å·²æ”¯å‡º ({{ Math.round(publicSpent/500000*100) }}%)</div>
            </div>
          </div>
          <div class="w-full bg-black/20 h-2 rounded-full mt-5 overflow-hidden relative z-10">
            <div class="bg-white h-full shadow-[0_0_10px_rgba(255,255,255,0.5)] transition-all duration-1000" :style="{width: Math.min((publicSpent/500000)*100, 100) + '%'}"></div>
          </div>
          <div class="mt-4 pt-3 border-t border-white/20 flex justify-between items-center text-slate-100 relative z-10">
            <span class="text-xs font-bold">åª½åª½å€‹äººèˆ‡åˆ†æ”¤æ”¯å‡º</span>
            <span class="font-bold font-mono text-lg">+ {{ formatNumber(Math.round(momSpent)) }}</span>
          </div>
          <div class="mt-2 flex justify-between items-center text-slate-100 relative z-10">
            <span class="text-xs font-bold">ç¿ŠèŒ¹å€‹äººèˆ‡åˆ†æ”¤æ”¯å‡º</span>
            <span class="font-bold font-mono text-lg">+ {{ formatNumber(Math.round(yiruSpent)) }}</span>
          </div>
        </div>

        <div class="mb-4 swipe-protected">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-bold text-[#55697B] text-lg">æ¶ˆè²»æ˜ç´°</h3>
                <button @click="showFilterMenu = !showFilterMenu" class="text-xs text-slate-500 bg-white border border-slate-200 px-3 py-1.5 rounded-lg font-bold flex items-center gap-1 transition"><span v-if="!showFilterMenu">ğŸ” ç¯©é¸</span><span v-else>â–² æ”¶èµ·</span></button>
            </div>
            <div v-if="showFilterMenu" class="glass-card p-4 mb-4 transition-all border-l-0">
                <div class="grid grid-cols-2 gap-3">
                    <select v-model="filters.item" class="glass-input px-3 py-2 rounded-lg text-xs font-bold outline-none"><option value="ALL">å…¨éƒ¨é …ç›®</option><option v-for="i in uniqueItems" :key="i" :value="i">{{ i }}</option></select>
                    <select v-model="filters.date" class="glass-input px-3 py-2 rounded-lg text-xs font-bold outline-none"><option value="ALL">å…¨éƒ¨æ—¥æœŸ</option><option v-for="d in uniqueExpDates" :key="d" :value="d">{{ d }}</option></select>
                    <select v-model="filters.payer" class="glass-input px-3 py-2 rounded-lg text-xs font-bold outline-none"><option value="ALL">å…¨éƒ¨ä»˜æ¬¾äºº</option><option v-for="p in members" :key="p" :value="p">{{ p }}</option></select>
                    <select v-model="filters.location" class="glass-input px-3 py-2 rounded-lg text-xs font-bold outline-none"><option value="ALL">å…¨éƒ¨åœ°é»</option><option v-for="l in uniqueLocations" :key="l" :value="l">{{ l }}</option></select>
                    <select v-model="filters.payment" class="glass-input px-3 py-2 rounded-lg text-xs font-bold outline-none col-span-2"><option value="ALL">å…¨éƒ¨ä»˜æ¬¾æ–¹å¼</option><option v-for="p in uniquePayments" :key="p" :value="p">{{ p }}</option></select>
                </div>
                <button @click="resetFilters" class="w-full mt-3 bg-slate-100 text-slate-500 py-2 rounded-lg text-xs font-bold hover:bg-slate-200 transition">é‡ç½®ç¯©é¸æ¢ä»¶</button>
            </div>
            <div class="flex flex-wrap gap-2 mb-2" v-if="hasActiveFilters">
                <span v-if="filters.item !== 'ALL'" @click="filters.item='ALL'" class="filter-chip">{{ filters.item }} âœ•</span>
                <span v-if="filters.date !== 'ALL'" @click="filters.date='ALL'" class="filter-chip">{{ filters.date }} âœ•</span>
                <span v-if="filters.payer !== 'ALL'" @click="filters.payer='ALL'" class="filter-chip">{{ filters.payer }} âœ•</span>
                <span v-if="filters.location !== 'ALL'" @click="filters.location='ALL'" class="filter-chip">{{ filters.location }} âœ•</span>
                 <span v-if="filters.payment !== 'ALL'" @click="filters.payment='ALL'" class="filter-chip">{{ filters.payment }} âœ•</span>
            </div>
        </div>

        <div class="glass-card p-4 mb-6 border-l-0">
          <div class="relative h-64 w-full"><div v-if="chartBusy" class="absolute inset-0 flex items-center justify-center text-xs text-slate-400 font-bold">åœ–è¡¨è¼‰å…¥ä¸­...</div><canvas id="expenseChart"></canvas></div>
        </div>

        <div class="space-y-3 mb-8">
          <div v-for="exp in filteredExpenses" :key="exp.row"
               :class="['glass-card p-4 transition hover:shadow-md mb-3 relative pl-4', getExpenseBorderClass(exp.item), isItemPending(exp.row) ? 'pending-sync' : '']">
            
            <div class="flex justify-between items-start gap-4">
              <div class="min-w-0">
                <div class="flex items-center gap-2 flex-wrap">
                  <span :class="['tag px-2 py-1 rounded text-xs font-bold', getItemTagClass(exp.item)]">{{ exp.item }}</span>
                  <span class="text-[10px] text-slate-400 font-mono font-bold uppercase">{{ exp.date }} Â· {{ exp.time }}</span>
                </div>
                <div class="mt-2 font-bold text-[#55697B] text-base break-anywhere allow-select" @click.stop>{{ exp.note ? exp.note : exp.item }}</div>
                <div class="text-xs text-[#8DA3B5] mt-2 flex items-center flex-wrap gap-2">
                  <span class="bg-slate-50 px-2 py-0.5 rounded text-slate-500 font-bold">{{ exp.payer }}</span>
                  <span v-if="exp.involved && exp.involved.length > 0" class="bg-[#F9EBEB] px-2 py-0.5 rounded text-[#D4A5A5] font-bold border border-[#F5E6E6] flex items-center gap-1"><span class="text-[9px] opacity-60">åˆ†</span>{{ exp.involved.join('ã€') }}</span>
                  <span class="text-[#2F86B8] font-bold bg-[#E4EEF5] px-2 py-0.5 rounded">{{ exp.payment }}</span>
                  <span class="text-slate-400 font-medium">{{ exp.location }}</span>
                </div>
              </div>
              <div class="text-right min-w-[96px] swipe-protected">
                <div class="text-right min-w-[96px] swipe-protected flex flex-col items-end justify-center h-full">
                    <div class="font-black text-[#55697B] text-lg tracking-tight flex items-baseline gap-1">
                        <span>{{ formatNumber(getAmountTWD(exp)) }}</span>
                        <span class="text-[10px] text-slate-400 font-bold">TWD</span>
                    </div>
                
                    <div v-if="exp.currency !== 'NTD'" class="text-[11px] text-[#2F86B8] font-mono font-bold mt-0.5 bg-[#E4EEF5] px-1.5 py-0.5 rounded border border-[#CBD5E1]">
                        {{ formatNumber(exp.amount) }} {{ exp.currency }}
                    </div>
                
                    <div class="mt-2 flex gap-2 justify-end opacity-60 hover:opacity-100 transition">
                        <button @click="openEditExp(exp)" class="text-[10px] text-[#2F86B8] bg-white border border-[#CBD5E1] px-2 py-1 rounded shadow-sm">ç·¨è¼¯</button>
                        <button @click="deleteExp(exp)" class="text-[10px] text-[#D4A5A5] bg-white border border-[#F5E6E6] px-2 py-1 rounded shadow-sm">åˆªé™¤</button>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div v-if="filteredExpenses.length===0" class="text-center text-slate-400 py-12 text-sm glass-panel rounded-2xl">å°šç„¡æ¶ˆè²»ç´€éŒ„</div>
        </div>

        <div class="glass-card p-6 mb-8 border-l-0">
          <h3 class="font-bold text-[#55697B] mb-4 border-b border-slate-100 pb-2 flex items-center">åˆ†å¸³çµç®—</h3>
          <div v-for="d in debts" :key="d.from + '_' + d.to" class="flex justify-between items-center py-3 text-sm border-b border-slate-50 last:border-0"><span class="flex items-center gap-2"><span class="font-bold text-[#D4A5A5] bg-[#F9EBEB] px-2 py-1 rounded border border-[#F5E6E6]">{{d.from}}</span><span class="text-slate-300 font-bold">-></span><span class="font-bold text-[#5F7359] bg-[#EDF2EC] px-2 py-1 rounded border border-[#E2E8E2]">{{d.to}}</span></span><span class="font-bold text-[#55697B] font-mono text-base">{{ formatNumber(d.amount) }}</span></div>
          <div v-if="debts.length===0" class="text-center text-slate-400 text-xs py-2">ç›®å‰å¤§å®¶éƒ½ä»˜å¾—å‰›å‰›å¥½ï¼Œæ²’æœ‰æ¬ æ¬¾ï¼</div>
        </div>
      </div>
    </Transition>
  </div>

  <Transition name="fade">
    <div v-if="showImgViewer" class="img-viewer-overlay" @click="closeImgViewer" @touchstart="handleImgTouchStart" @touchmove="handleImgTouchMove" @touchend="handleImgTouchEnd" @dblclick="toggleZoom"> <div v-if="imgGesture.scale === 1" :class="['pull-hint', {'show-hint': imgGesture.isPulling}]">â†“ ä¸‹æ‹‰é—œé–‰</div><div class="img-viewer-close" @click.stop="closeImgViewer">âœ•</div><img :src="viewingImg" ref="imgViewerEl" class="img-viewer-img" @click.stop></div>
  </Transition>
  
  </div>

<Transition name="modal">
    <div v-if="showItinModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 swipe-protected"><div class="absolute inset-0 bg-[#475569]/40 backdrop-blur-sm" @click="showItinModal=false"></div><div class="modal-content w-full max-w-sm bg-white rounded-3xl shadow-2xl overflow-hidden relative z-10"><div class="bg-slate-50 p-4 border-b flex justify-between items-center"><h3 class="font-bold text-[#55697B]">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3><button @click="showItinModal=false" class="text-slate-400 p-2">âœ•</button></div><div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto"><div class="flex gap-3"><div class="w-1/2"><label class="text-[10px] font-bold text-slate-400 uppercase">é–‹å§‹æ™‚é–“</label><input type="time" v-model="itinForm.startTime" class="w-full glass-input p-3 rounded-xl mt-1 outline-none font-bold"></div><div class="w-1/2"><label class="text-[10px] font-bold text-slate-400 uppercase">çµæŸæ™‚é–“ (é¸)</label><input type="time" v-model="itinForm.endTime" class="w-full glass-input p-3 rounded-xl mt-1 outline-none font-bold"></div></div><div><label class="text-[10px] font-bold text-slate-400 uppercase">é¡åˆ¥</label><div class="flex gap-2 mt-1 flex-wrap"><button v-for="c in ['æ™¯é»','é£²é£Ÿ','äº¤é€š','ä½å®¿','å…¶ä»–']" :key="c" @click="itinForm.category=c" :class="['flex-1 min-w-[3rem] py-2 rounded-xl text-xs font-bold border transition', itinForm.category===c ? 'bg-[#2F86B8] text-white border-[#2F86B8] shadow-md' : 'bg-white text-slate-500 border-slate-200']">{{c}}</button></div></div><div><label class="text-[10px] font-bold text-slate-400 uppercase">æ¨™é¡Œ</label><input v-model="itinForm.title" class="w-full glass-input p-3 rounded-xl mt-1 outline-none font-bold placeholder-slate-300" placeholder="è¡Œç¨‹åç¨±"></div><div><label class="text-[10px] font-bold text-slate-400 uppercase">åœ–ç‰‡ (é»æ“Šä¸Šå‚³)</label><div class="img-upload-btn mt-1"><div v-if="!itinForm.imgUrl" class="img-preview"><span>+ é¸æ“‡ç…§ç‰‡</span></div><div v-else class="relative"><img :src="itinForm.imgUrl" class="w-full h-32 object-cover rounded-xl border border-slate-200"><button @click.prevent="removeImage" class="absolute top-2 right-2 bg-rose-400 text-white rounded-full p-1 shadow-md text-xs font-bold px-2">ç§»é™¤</button></div><input type="file" accept="image/*" @change="handleImageUpload" v-if="!itinForm.imgUrl || itinForm.newImageBase64"></div></div><div><label class="text-[10px] font-bold text-slate-400 uppercase">åœ°é» (Google Maps)</label><input v-model="itinForm.location" class="w-full glass-input p-3 rounded-xl mt-1 outline-none text-sm" placeholder="è¼¸å…¥åœ°é»"></div><div><label class="text-[10px] font-bold text-slate-400 uppercase">é€£çµ (é¸)</label><input v-model="itinForm.link" class="w-full glass-input p-3 rounded-xl mt-1 outline-none text-sm text-[#2F86B8]" placeholder="https://..."></div><div><label class="text-[10px] font-bold text-slate-400 uppercase">å‚™è¨» (æ”¯æ´ [æ–‡å­—](url))</label><textarea v-model="itinForm.note" rows="3" class="w-full glass-input p-3 rounded-xl mt-1 outline-none text-sm" placeholder="å‚™è¨»äº‹é …..."></textarea></div></div><div class="p-4 bg-slate-50 border-t flex gap-3"><button @click="showItinModal=false" class="flex-1 btn-cancel py-3 rounded-xl font-bold shadow-sm">å–æ¶ˆ</button><button @click="submitItin" class="flex-1 btn-glacier py-3 rounded-xl font-bold shadow-lg">å„²å­˜</button></div></div></div>
  </Transition>
  <Transition name="modal">
    <div v-if="showExpModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 swipe-protected"><div class="absolute inset-0 bg-[#475569]/40 backdrop-blur-sm" @click="showExpModal=false"></div><div class="modal-content w-full max-w-sm bg-white rounded-3xl shadow-2xl relative z-10 p-6 space-y-4 max-h-[85vh] overflow-y-auto"><h3 class="font-bold text-[#55697B] text-lg">ç·¨è¼¯æ¶ˆè²»</h3><div class="flex gap-3"><select v-model="editExpForm.payer" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>æ³¥æ˜¯èª°</option><option>å®¶é½Š</option><option>äº­ç©</option><option>åª½åª½</option></select><select v-model="editExpForm.location" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>åœ¨å“ªæ¶ˆè²»</option><option>å°ç£</option><option>æœæ‹œ</option><option>æŒªå¨</option><option>å†°å³¶</option><option>è‹±åœ‹</option></select></div><div class="flex gap-3"><select v-model="editExpForm.item" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>æ¶ˆè²»é …ç›®</option><option>æ—©é¤</option><option>åˆé¤</option><option>æ™šé¤</option><option>é›¶é£Ÿ</option><option>ä½å®¿</option><option>äº¤é€šï¼ˆæ©Ÿç¥¨ï¼‰</option><option>äº¤é€šï¼ˆç§Ÿè»Šï¼‰</option><option>äº¤é€šï¼ˆåœè»Šè²»ï¼‰</option><option>äº¤é€šï¼ˆæ²¹éŒ¢ï¼‰</option><option>ç´€å¿µå“</option><option>é–€ç¥¨</option><option>å…¶ä»–</option></select><select v-model="editExpForm.payment" class="w-1/2 glass-input p-3 rounded-xl text-sm outline-none font-bold"><option value="" disabled selected>ä»˜æ¬¾æ–¹å¼</option><option>ç¾é‡‘</option><option>ä¿¡ç”¨å¡-åœ‹æ³°</option><option>ä¿¡ç”¨å¡-æ°¸è±</option><option>ä¿¡ç”¨å¡-å…ƒå¤§</option></select></div><div class="flex gap-3"><select v-model="editExpForm.currency" class="w-1/3 glass-input p-3 rounded-xl text-sm font-bold bg-[#E2E8F0] text-slate-600"><option>NTD</option><option>NOK</option><option>ISK</option><option>EUR</option><option>GBP</option><option>AED</option></select><input type="number" v-model="editExpForm.amount" class="w-2/3 glass-input p-3 rounded-xl text-xl font-bold" placeholder="é‡‘é¡"></div><div class="text-xs text-right text-slate-400 font-mono font-bold" v-if="editExpForm.amount && editExpForm.currency !== 'NTD'">â‰ˆ {{ formatNumber(Math.round(editExpForm.amount * rates[editExpForm.currency])) }} NTD</div><input v-model="editExpForm.note" class="w-full glass-input p-3 rounded-xl text-sm" placeholder="å‚™è¨»"><div class="bg-slate-50/50 p-4 rounded-xl border border-slate-100"><div class="flex justify-between items-center mb-3"><span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">åˆ†æ”¤çµ¦</span><button @click="toggleSelectAllEdit" class="text-[10px] text-[#2F86B8] font-bold bg-white px-2 py-1 rounded shadow-sm">å…¨é¸</button></div><div class="flex gap-2 flex-wrap"><label v-for="m in members" :key="m" class="flex flex-1 justify-center items-center space-x-2 border px-4 py-3 rounded-xl cursor-pointer transition-all duration-200" :class="(editExpForm.involved || []).includes(m)?'bg-white border-[#2F86B8] text-[#55697B] shadow-sm':'bg-transparent border-slate-200 text-slate-400'"><input type="checkbox" :value="m" v-model="editExpForm.involved" class="hidden"><span class="text-sm font-bold">{{m}}</span></label></div></div><div class="flex gap-2"><button @click="submitEditExp" class="flex-1 btn-glacier py-3 rounded-xl font-bold">æ›´æ–°</button><button @click="showExpModal=false" class="px-4 bg-slate-100 text-slate-500 rounded-xl font-bold">å–æ¶ˆ</button></div></div></div>
  </Transition>
  <Transition name="modal">
    <div v-if="showRateModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 swipe-protected"><div class="absolute inset-0 bg-[#475569]/40 backdrop-blur-sm" @click="showRateModal=false"></div><div class="modal-content w-full max-w-sm bg-white rounded-3xl shadow-2xl relative z-10 p-6"><h3 class="font-bold text-[#55697B] mb-4">è¨­å®šåŒ¯ç‡ (å°å°å¹£)</h3><div class="space-y-3"><div v-for="c in ['NOK','ISK','EUR','GBP','AED']" :key="c" class="flex items-center gap-3"><span class="w-10 font-bold text-slate-400 text-sm">{{c}}</span><input type="number" v-model="tempRates[c]" class="flex-1 glass-input p-2 rounded-lg font-mono font-bold text-right"></div></div><button @click="saveRates" class="w-full btn-glacier mt-6 py-3 rounded-xl font-bold">å„²å­˜è¨­å®š</button></div></div>
  </Transition>
</div>

<script src="app.js" defer></script>
</body>
</html>
